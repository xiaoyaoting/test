{"version":3,"file":"base.js","names":["BaseClient","require","schema","ABTNodeClient","constructor","httpEndpoint","userAgent","config","dataSource","socketEndpoint","_getSocketEndpoint","enableQuery","enableSubscription","enableMutation","maxQueryDepth","_endpoint","_authToken","_userAgent","setAuthToken","token","endpoint","replace","indexOf","_getSchema","_getIgnoreFields","name","_getAuthHeaders","headers","val","Authorization","encodeURIComponent","window","location","hostname","port","protocol","endsWith","substring","length","module","exports"],"sources":["../src/base.js"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\nconst BaseClient = require('@arcblock/sdk-util');\n\nconst schema = require('./schema/graphql.json');\n\n/**\n * Provides a readonly client to forge\n * Its recommended to use this version in browser to get smaller bundle size\n *\n * @class ABTNodeClient\n * @extends {BaseClient}\n */\nclass ABTNodeClient extends BaseClient {\n  constructor(httpEndpoint = 'http://localhost:4000/api', userAgent = '') {\n    const config = {\n      dataSource: 'forge',\n      httpEndpoint,\n      socketEndpoint: () => this._getSocketEndpoint(httpEndpoint),\n      enableQuery: true,\n      enableSubscription: true,\n      enableMutation: true,\n      maxQueryDepth: 6,\n    };\n\n    super(config);\n\n    this._endpoint = httpEndpoint;\n    this._authToken = null;\n    this._userAgent = userAgent;\n  }\n\n  setAuthToken(token) {\n    this._authToken = token;\n  }\n\n  _getSocketEndpoint(endpoint) {\n    let socketEndpoint = endpoint.replace(/https?:\\/\\//, 'ws://');\n    if (endpoint.indexOf('https://') === 0) {\n      socketEndpoint = socketEndpoint.replace('ws://', 'wss://');\n    }\n\n    return `${socketEndpoint}/socket`;\n  }\n\n  _getSchema() {\n    return schema;\n  }\n\n  // eslint-disable-next-line\n  _getIgnoreFields({ name }) {\n    return [];\n  }\n\n  _getAuthHeaders() {\n    const headers = {};\n    const token = this._authToken;\n    if (token) {\n      const val = typeof token === 'function' ? token() : token;\n      headers.Authorization = `Bearer ${encodeURIComponent(val)}`;\n    }\n\n    // eslint-disable-next-line no-undef\n    if (typeof window !== 'undefined' && typeof window.location !== 'undefined') {\n      const { hostname, port, protocol } = window.location; // eslint-disable-line no-undef\n      headers['x-real-hostname'] = hostname;\n      headers['x-real-port'] = port;\n      headers['x-real-protocol'] = protocol.endsWith(':') ? protocol.substring(0, protocol.length - 1) : protocol;\n    }\n\n    if (this._userAgent) {\n      headers['User-Agent'] = this._userAgent;\n    }\n\n    return headers;\n  }\n}\n\nmodule.exports = ABTNodeClient;\n"],"mappings":";;;;;AAAA;AACA,MAAMA,UAAU,GAAGC,OAAO,CAAC,oBAAoB,CAAC;AAEhD,MAAMC,MAAM,GAAGD,OAAO,CAAC,uBAAuB,CAAC;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAME,aAAa,SAASH,UAAU,CAAC;EACrCI,WAAW,GAA6D;IAAA,IAA5DC,YAAY,uEAAG,2BAA2B;IAAA,IAAEC,SAAS,uEAAG,EAAE;IACpE,MAAMC,MAAM,GAAG;MACbC,UAAU,EAAE,OAAO;MACnBH,YAAY;MACZI,cAAc,EAAE,MAAM,IAAI,CAACC,kBAAkB,CAACL,YAAY,CAAC;MAC3DM,WAAW,EAAE,IAAI;MACjBC,kBAAkB,EAAE,IAAI;MACxBC,cAAc,EAAE,IAAI;MACpBC,aAAa,EAAE;IACjB,CAAC;IAED,KAAK,CAACP,MAAM,CAAC;IAEb,IAAI,CAACQ,SAAS,GAAGV,YAAY;IAC7B,IAAI,CAACW,UAAU,GAAG,IAAI;IACtB,IAAI,CAACC,UAAU,GAAGX,SAAS;EAC7B;EAEAY,YAAY,CAACC,KAAK,EAAE;IAClB,IAAI,CAACH,UAAU,GAAGG,KAAK;EACzB;EAEAT,kBAAkB,CAACU,QAAQ,EAAE;IAC3B,IAAIX,cAAc,GAAGW,QAAQ,CAACC,OAAO,CAAC,aAAa,EAAE,OAAO,CAAC;IAC7D,IAAID,QAAQ,CAACE,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE;MACtCb,cAAc,GAAGA,cAAc,CAACY,OAAO,CAAC,OAAO,EAAE,QAAQ,CAAC;IAC5D;IAEA,iBAAUZ,cAAc;EAC1B;EAEAc,UAAU,GAAG;IACX,OAAOrB,MAAM;EACf;;EAEA;EACAsB,gBAAgB,OAAW;IAAA,IAAV;MAAEC;IAAK,CAAC;IACvB,OAAO,EAAE;EACX;EAEAC,eAAe,GAAG;IAChB,MAAMC,OAAO,GAAG,CAAC,CAAC;IAClB,MAAMR,KAAK,GAAG,IAAI,CAACH,UAAU;IAC7B,IAAIG,KAAK,EAAE;MACT,MAAMS,GAAG,GAAG,OAAOT,KAAK,KAAK,UAAU,GAAGA,KAAK,EAAE,GAAGA,KAAK;MACzDQ,OAAO,CAACE,aAAa,oBAAaC,kBAAkB,CAACF,GAAG,CAAC,CAAE;IAC7D;;IAEA;IACA,IAAI,OAAOG,MAAM,KAAK,WAAW,IAAI,OAAOA,MAAM,CAACC,QAAQ,KAAK,WAAW,EAAE;MAC3E,MAAM;QAAEC,QAAQ;QAAEC,IAAI;QAAEC;MAAS,CAAC,GAAGJ,MAAM,CAACC,QAAQ,CAAC,CAAC;MACtDL,OAAO,CAAC,iBAAiB,CAAC,GAAGM,QAAQ;MACrCN,OAAO,CAAC,aAAa,CAAC,GAAGO,IAAI;MAC7BP,OAAO,CAAC,iBAAiB,CAAC,GAAGQ,QAAQ,CAACC,QAAQ,CAAC,GAAG,CAAC,GAAGD,QAAQ,CAACE,SAAS,CAAC,CAAC,EAAEF,QAAQ,CAACG,MAAM,GAAG,CAAC,CAAC,GAAGH,QAAQ;IAC7G;IAEA,IAAI,IAAI,CAAClB,UAAU,EAAE;MACnBU,OAAO,CAAC,YAAY,CAAC,GAAG,IAAI,CAACV,UAAU;IACzC;IAEA,OAAOU,OAAO;EAChB;AACF;AAEAY,MAAM,CAACC,OAAO,GAAGrC,aAAa"}