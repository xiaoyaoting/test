const AES = require('@ocap/mcrypto/lib/crypter/aes').default;
const { fromBase58 } = require('@ocap/util');

const VERSION = '1.0.0';

const decrypt = (data, config = {}, dataKey = 'userInfo') => {
  if (config.sharedKey && data.version === VERSION) {
    data[dataKey] = AES.decrypt(fromBase58(data[dataKey]), config.sharedKey, 'buffer').toString('utf8');
  }
  return data;
};

const encrypt = (data, config = {}, dataKey = 'authInfo') => {
  const { clientVersion, sharedKey } = config || {};
  if (sharedKey && clientVersion === VERSION) {
    data.version = VERSION;
    data[dataKey] = AES.encrypt(data[dataKey], sharedKey, 'base58');
  }
  return data;
};

module.exports = {
  decrypt,
  encrypt,
};
