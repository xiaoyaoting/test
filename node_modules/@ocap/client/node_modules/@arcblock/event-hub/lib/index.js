const Client = require('./client');
const ClientFallback = require('./client-fallback');

const port = Number(process.env.ABT_NODE_EVENT_PORT);
const hostname = Number(process.env.ABT_NODE_EVENT_HOSTNAME) || '127.0.0.1';

let did;
let sk;

if (process.env.BLOCKLET_APP_SK && process.env.BLOCKLET_APP_ID) {
  sk = process.env.BLOCKLET_APP_SK;
  did = process.env.BLOCKLET_APP_ID;
} else if (process.env.ABT_NODE_SK && process.env.ABT_NODE_DID) {
  sk = process.env.ABT_NODE_SK;
  did = process.env.ABT_NODE_DID;
}

if (port && did && sk) {
  module.exports = new Client({ port, hostname, did, sk, autoConnect: true });
} else {
  // export fallback Client because missing any of port / did / sk
  module.exports = new ClientFallback();
}
